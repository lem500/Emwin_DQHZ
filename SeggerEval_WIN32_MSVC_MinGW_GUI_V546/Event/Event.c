#include "Event.h"#include "../usr/datastruct.h"/***********************全局变量初始化********************************************/U16 EventFlashBasePointer; //本次启动事件记录指针U16 EventFlashCurrentPointer;//事件当前记录指针U16 EventRamCurrentPointer;//RAM记录指针U16 EventRamPrinterPointer; //打印指针U16 EventRamTaskPointer; //显示声音指针U16 EventFlashAlarmBasePointer; //本次启动火警事件记录指针U16 EventFlashAlarmCurrentPointer;//火警事件当前指针U16 EventFireRamCurrentPointer;U16 EventFaultRamCurrentPointer;U16 EventAlarmCount; //报警总数U16 EventFaultCount;//故障总数U16 EventStartCount;//启动总数U8 EventSoundState;//声音状态U8 EventSwitchTimer;//事件切换定时，SYSTEM_EVENT EventRamBuffer[EVENT_ALL_COUNT + 1];SYSTEM_EVENT EventFireRamBuffer[EVENT_ALARM_COUNT + 1];SYSTEM_EVENT EventFireRecordRamBuffer[ EVENT_ALARM_COUNT+ 1];SYSTEM_EVENT EventFaultRamBuffer[EVENT_FAULT_COUNT + 1];U8 EventRamType[EVENT_ALL_COUNT + 1];U8  EventRamType[EVENT_ALL_COUNT + 1];/*************************全局变量初始化*******************************************//*****************************************************************函数名称:void EventInit(void)函数功能:事件记录初始化，描    述:在系统上电时调用；******************************************************************/void EventInit(void){    SYSTEM_EVENT Event;    //存储指针初始化    for(EventFlashBasePointer = 0;EventFlashBasePointer < EVENT_ALL_COUNT; EventFlashBasePointer++)    {        ReadOtherEvent(&Event,EventFlashBasePointer);        if (Event.EventCode == EVENT_INVALID_CODE)		    {			    break;		    }    }    EventFlashCurrentPointer = EventFlashBasePointer;		//事件记录指针    //报警记录指针初始化    for (EventFlashAlarmBasePointer = 0; EventFlashAlarmBasePointer < EVENT_ALARM_COUNT; EventFlashAlarmBasePointer++)    {		ReadAlarmEvent(&Event, EventFlashAlarmBasePointer);		if (Event.EventCode != EVENT_FIRE)		{			break;		}    }    EventFlashAlarmCurrentPointer = EventFlashAlarmBasePointer;//报警记录指针初始化    EventRamCurrentPointer  = 0;   //RAM记录指针    EventRamPrinterPointer  = 0;   //打印指针    EventRamTaskPointer     = 0;   //显示，声音等指针	EventFireRamCurrentPointer 		= 0;	EventFaultRamCurrentPointer 	= 0;	EventSoundState = 0; //声音状态    memset(EventRamBuffer, 0, sizeof(EventRamBuffer));}//写本机事件到FLASHvoid WriteEventToFlash(SYSTEM_EVENT *pEvent){}//声音显示事件处理void EventLedSoundDisplayProcess(U8 EventType){}//屏蔽事件处理void EventShiledProcess(void){}//开放事件处理void EventOpenProcess(void){}//新事件处理void EventTask(void){    int i,j;    if (EventRamCurrentPointer == EventRamTaskPointer)    {        return;         //没有新事件    }    switch (EventRamType[EventRamTaskPointer]) //根据事件类型分类处理    {        case EVENT_TYPE_ALARM:              //报警            EventAlarmCount++;			//火警事件单列出来            memcpy(&EventFireRamBuffer[EventFireRamCurrentPointer], &EventRamBuffer[EventRamTaskPointer], 64);            EventFireRamCurrentPointer++;            if (EventFireRamCurrentPointer == EVENT_ALARM_COUNT)            {                EventFireRamCurrentPointer = 0;            }			break;        case EVENT_TYPE_FAULT:			    //2故障            EventFaultCount++;            break;        case EVENT_TYPE_FAULT_RESUME:	    //    3故障恢复            break;        case EVENT_TYPE_DISABLE:			//屏蔽			//EventShiledProcess();			break;		case EVENT_TYPE_DISABLE_CANCLE:			//屏蔽取消			//EventOpenProcess();			break;        default:            break;    }	EventLedSoundDisplayProcess(EventRamType[EventRamTaskPointer]);    EventRamTaskPointer++;}